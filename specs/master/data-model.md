# Data Model: Todo Backend API

## Task Entity

### Fields
- **id** (integer, primary key)
  - Auto-incrementing unique identifier for each task
  - Required for all operations
  - Generated by the database

- **user_id** (string, indexed)
  - The ID of the user who owns this task
  - Required for all operations
  - Used for enforcing user-level data isolation
  - Extracted from JWT token during API requests

- **title** (string, 1-200 characters, required)
  - The title of the task
  - Required field with length validation
  - Must be between 1 and 200 characters

- **description** (text, optional, max 1000 characters)
  - Optional detailed description of the task
  - Can be null or empty
  - Maximum length of 1000 characters

- **completed** (boolean)
  - Status of whether the task is completed
  - Default value: false
  - Can be toggled via API

- **created_at** (timestamp)
  - Timestamp when the task was created
  - Auto-generated by the system
  - Used for sorting and tracking

- **updated_at** (timestamp)
  - Timestamp when the task was last updated
  - Auto-updated whenever the task is modified
  - Used for tracking changes

### Relationships
- **Owner Relationship**: Each task belongs to exactly one user (identified by user_id)
- **No other relationships**: Tasks are independent of each other

### Validation Rules
1. **Title validation**:
   - Required field
   - Must be between 1 and 200 characters
   - Cannot be empty or whitespace-only

2. **Description validation**:
   - Optional field
   - If provided, must not exceed 1000 characters

3. **User ownership validation**:
   - user_id must match the authenticated user's ID from JWT
   - Users can only access tasks with their own user_id

4. **Completion status validation**:
   - Must be a boolean value (true/false)

### Indexes
1. **user_id index** (required):
   - Purpose: Efficient filtering of tasks by user
   - Critical for performance when retrieving user's tasks
   - Required for enforcing user-level data isolation

2. **completed index** (optional but recommended):
   - Purpose: Efficient filtering of tasks by completion status
   - Useful for queries that filter completed vs. incomplete tasks

### State Transitions
- **Creation**: When a task is created, `completed` is set to `false` by default, `created_at` and `updated_at` are set to the current timestamp
- **Update**: When a task is updated, `updated_at` is set to the current timestamp
- **Completion**: When a task's completion status is toggled, `completed` is flipped and `updated_at` is updated
- **Deletion**: Task is removed from the database (soft delete could be implemented later if needed)

## User Entity (Referenced via JWT)

### Fields (from JWT token)
- **user_id** (string)
  - Extracted from the JWT payload
  - Used to enforce ownership of tasks
  - Never stored in the backend database (only referenced)

### Notes
- The user entity is managed by Better Auth
- The backend only verifies the JWT and extracts user_id
- No user data is stored in the backend database
- All task operations are filtered by the authenticated user's ID